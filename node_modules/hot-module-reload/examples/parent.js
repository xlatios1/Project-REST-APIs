var fs = require('fs');
var path = require('path');
var HotReload = require('../index.js');

HotReload(function() {
  var child = require('./child');
  console.log(child);
  setTimeout(increaseCount, 700);
});


function increaseCount() {
  var codePath = path.resolve(__dirname, './child.js');
  var code = fs.readFileSync(codePath, 'utf8');
  code = code.replace(/Count (\d+)/, function(match, count) {
    var next = parseInt(count) + 1;
    return "Count " + next;
  });
  fs.writeFileSync(codePath, code);
}